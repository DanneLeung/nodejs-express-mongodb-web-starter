//
   Created by danne on 2015/10/29.
extends ../../layouts/default
block header
//应用的page title
block pageTitle
  if viewType == 'add'
    h1 系统功能模块新增
      small 添加系统功能模块
  if viewType == 'edit'
    h1 系统功能模块编辑
      small 编辑系统设功能模块

block main
  .panel
    .panel-heading.with-border
      if viewType == 'add'
        h3.panel-title 添加系统功能模块
      if viewType == 'edit'
        h3.panel-title 编辑系统功能模块

      .panel-tools
        a.btn.btn-sm.btn-default(href='/system/module' title="返回")
          i.fa.fa-reply
        | &nbsp;
        if viewType == 'add' || viewType == 'edit'
          button#save.btn.btn-sm.btn-default(title="保存")
            i.fa.fa-save
        | &nbsp;

    .panel-body
      div.row
        .col-md-12
          if viewType == 'edit'
            form#delForm(method='post', style='display:none', action='/system/module/del')
              input#ids(type='hidden',name='ids',value="#{module._id}")
              input#_csrf(type='hidden', name='_csrf', value=_csrf)

          form#moduleForm.form-horizontal(name='messageForm', action='/system/module/save', method='post')
            if viewType == 'edit'
              input#id(type='hidden', name='id', value="#{module._id}")

            input#_csrf(type='hidden', name='_csrf', value=_csrf)
            .form-group
              label.control-label.col-md-3.required 名称：
              .controls.col-md-8
                input#name.form-control.required(name='name', value="#{module ? module.name : ''}")
            .form-group
              label.control-label.col-md-3.required 描述：
              .controls.col-md-8
                textarea#description.form-control.required(name='description')
                  | #{module ? module.description : ''}


//应用添加的脚本在scripts block中定义
block scripts
  script(src='/themes/default/plugins/input-mask/jquery.inputmask.js')
  script(src='/themes/default/plugins/input-mask/jquery.inputmask.date.extensions.js')
  script.
    $(document).ready(function () {
      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue',
        increaseArea: '20%' // optional
      });
      var form = $('#moduleForm');
      $("#save").on('click', function () {
        form.submit();
      });

      form.validate({
        rules: {
          name: {
            required: true,
            remote: '/system/module/checkname?oldName=#{module ? module.name : ''}'
          },
          description: {
            required: true
          }
        },
        messages: {
          name: {
            remote: '此模块名称已经存在!'
          }
        }
      });

      $('#del').on('click', function () {
        bootbox.confirm("确定要删除数据吗?", function (result) {
          if (result) {
            $("#delForm").submit();
          }
        });
      });


    });

