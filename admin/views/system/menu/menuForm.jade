//
   Created by yu869 on 2015/11/9.

//
   Created by yu869 on 2015/11/9.
extends ../../layouts/default
block header
  link( rel="stylesheet" href="//cdn.bootcss.com/datatables/1.10.11/css/dataTables.bootstrap.min.css")
  link( rel="stylesheet" href="/themes/default/plugins/select2/select2.min.css")
//应用的page title
block pageTitle
  if viewType == 'add'
    h1 菜单新增
      small 添加菜单信息
  if viewType == 'edit'
    h1 菜单编辑
      small 编辑菜单信息
  if viewType == 'view'
    h1 菜单查看
      small 查看菜单信息
block main
  .panel
    .panel-heading.with-border
      if viewType == 'add'
        h3.panel-title 添加菜单信息
      if viewType == 'edit'
        h3.panel-title 编辑菜单信息
      if viewType == 'view'
        h3.panel-title 查看菜单信息

      .panel-tools
        a.btn.btn-sm.btn-default(href='/system/menu/' title='返回')
          i.fa.fa-reply
        button#save.btn.btn-sm.btn-default(title='保存')
          i.fa.fa-save
    .panel-body
      div#menuEdit.row
        .col-md-12
          form#menuForm.form-horizontal(name='menuForm', action='/system/menu/save', method='post')
            if viewType == 'edit'
              input#id(type='hidden', name='id', value="#{menu == null ? '' : menu._id}")

            input#_csrf(type='hidden', name='_csrf', value=_csrf)
            .form-group
              label.control-label.col-sm-2 上级菜单:
              .col-sm-9
                select#parentId.form-control(name='parentId')
                  option(value="") --请选择--
                  each m in menus
                    if(m.id == menu.parentId)
                      option(value="#{m.id}", selected="selected") #{paddingLeft(m.title, ' - ', m.depth - 1)}
                    else
                      option(value="#{m.id}") #{paddingLeft(m.title, ' - ', m.depth - 1)}
            //- .form-group
              label.control-label.col-sm-2 模块:
              .col-sm-9
                select#module.form-control(name='module')
                  option(value="") --请选择--
                  each m in modules
                    if(m.id == menu.module)
                      option(value="#{m.id}", selected="selected") #{m.name}
                    else
                      option(value="#{m.id}") #{m.name}

            .form-group
              label.control-label.col-sm-2.required 标题:
              .col-sm-9
                input#title.form-control.required(type='text',name='title',placeholder='标题', value="#{menu == null ? '' : menu.title}")
            .form-group
              label.control-label.col-sm-2.required 标识:
              .col-sm-9
                input#code.form-control.required(type='text',name='code',placeholder='标识', value="#{menu == null ? '' : menu.code}")
                //if(menu.isNew)
                //else
                //  input#code.form-control(type='text',name='code',placeholder='标识', value="#{menu == null ? '' : menu.code}",disabled="true")
                p.help-block 唯一标识，不可与其它菜单重复，不可为空，创建后不可修改
            .form-group
              label.control-label.col-sm-2 链接:
              .col-sm-9
                input#link.form-control(type='text',name='link',placeholder='菜单链接Url', value="#{menu == null ? '' : menu.link}")
            .form-group
              label.control-label.col-sm-2 图标:
              .col-sm-9
                input#iconClass.form-control(type='text',name='iconClass',placeholder='菜单的图标', value="#{menu == null ? '' : menu.iconClass}")
                p.help-block 图标的css class名称，如fa fa-user
            .form-group
              label.control-label.col-sm-2 排序:
              .col-sm-9
                input#sort.form-control(type='number',name='sort',placeholder='菜单排序', value="#{menu == null ? '' : menu.sort}")
                p.help-block 同级菜单中排序序号，越小排序越靠前

            .form-group
              label.control-label.col-sm-2 顶置菜单:
              .col-sm-9
                .checkbox.icheck
                  label
                    if(menu.topNav)
                      input(type='checkbox',name="topNav", checked="checked")
                    else
                      input(type='checkbox',name="topNav")
            .form-group
              label.control-label.col-sm-2 激活:
              .col-sm-9
                .checkbox.icheck
                  label
                    if(menu.enabled)
                      input(type='checkbox',name="enabled", checked="checked")
                    else
                      input(type='checkbox',name="enabled")

//应用添加的脚本在scripts block中定义
block scripts
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/jquery.dataTables.min.js')
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/dataTables.bootstrap.min.js')
  script.
    $(document).ready(function () {
      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue',
        increaseArea: '20%' // optional
      });

      var form = $('#menuForm');
      $("#save").on('click', function () {
        form.submit();
      });
      form.validate({
        rules: {
          type: {
            required: true
          },
          title: {
            required: true
          }
        },
        messages: {
          type: "设备名称必填！",
          title: "菜单标题必填！"
        }
      });
    });

