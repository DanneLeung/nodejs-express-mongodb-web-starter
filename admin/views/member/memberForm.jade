//
   Created by danne on 2015/10/29.
extends layout
block header
  link( rel="stylesheet" href="//cdn.bootcss.com/bootstrap-datepicker/1.6.0/css/bootstrap-datepicker3.min.css")
//应用的page title
block pageTitle
  if viewType == 'view'
    h1 会员信息审核
      small 查看会员信息审核

block main
  .panel
    .panel-heading.with-border
      if viewType == 'view'
        h3.panel-title 查看会员信息

      .panel-tools
        a.btn.btn-box-tool.btn-default(href='/member/list')
          i.fa.fa-reply
          span  返回
        | &nbsp;
        button#save.btn.btn-box-tool.btn-default
          i.fa.fa-save
          span  保存
        | &nbsp;
    .panel-body
      div#userEdit.row
        .col-md-12
          form#cardForm.form-horizontal(name='cardForm', action='/member/cardSave', method='post')
            input#id(type='hidden', name='id', value="#{card._id}")
            input#_csrf(type='hidden', name='_csrf', value=_csrf)
            .form-group
              label.control-label.col-md-3 用户名：
              .controls.col-md-9
                input#cardNo.form-control.required(name='cardNo', value="#{card ? card.cardNo : ''}")
            .form-group
              label.control-label.col-md-3 姓名：
              .controls.col-md-9

            .form-group
              label.control-label.col-md-3 手机：
                span.required *
              .controls.col-md-9
                input#validCode.form-control.required(name='validCode', value="#{card ? card.validCode : ''}")
            .form-group
              label.control-label.col-md-3 身份证：
                span.required *
              .controls.col-md-9
                input#date.form-control(name='date',readonly='true', value="#{card != null ? formatDate(card.date) : ''}")
            .form-group
              label.control-label.col-md-3 启用：
                span.required *
              .controls.col-md-9
                input#price.form-control.required(name='price', value="#{card ? card.price : ''}")
            .form-group
              label.control-label.col-md-3 可用次数：
                span.required *
              .controls.col-md-9
                input#count.form-control.required(name='count', value="#{card ? card.count : ''}")
            .form-group
              label.control-label.col-md-3 说明：
                span.required *
              .controls.col-md-9
                input#description.form-control.required(name='description', value="#{card ? card.description : ''}")
            .form-group
              label.control-label.col-md-3 已使用：
                span.required *
              .controls.col-md-9
                input#used.form-control(type="checkbox", name="used", value="#{card ? card.used : ''}", checked="checked")

            //.form-group
            //  label.control-label.col-md-3 名字：
            //  .controls.col-md-9
            //    input#firstname.form-control(name='firstname', value="#{card ? card.firstname : ''}")

//应用添加的脚本在scripts block中定义
block scripts
  script(src='/themes/default/plugins/datepicker/bootstrap-datepicker.js')
  script.
    $(document).ready(function () {

      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue',
        increaseArea: '20%' // optional
      });
      var form = $('#cardForm');
      $("#save").on('click', function () {
        form.submit();
      });

      form.validate({
        ignore: '.ignore',
        rules: {
          cardNo: {
            required: true,
            remote: '/member/checkname?oldcardNo=#{card ? card.cardNo : ''}'
          },
          validCode: {
            required: true
          },
          date: {
            required: true
          },
          type: {
            required: true
          },
          price: {
            required: true
          },
          count: {
            required: true
          },
          description: {
            required: true
          }
        },
        messages: {
          serverName: {
            remote: '该用户已经存在!'
          }
        }
      });

      $('#del').on('click', function () {
        bootbox.confirm("确定要删除数据吗?", function (result) {
          if (result) {
            $("#cardDelForm").submit();
          }
        });
      });
      var dates = $('#date').datepicker({
        format: "yyyy-mm-dd",
        language: 'cn',
        weekStart: 1,
        autoclose: true,
        defaultDate: new Date(),
        todayBtn: 'linked'
      }).on('changeDate', function (ev) {
        $('#date').val(ev.date);
      });

    });

