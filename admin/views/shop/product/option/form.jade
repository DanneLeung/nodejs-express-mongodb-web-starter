//
   Created by Renee on 2016/5/10.

extends ../layout
block header
  //link( rel="stylesheet" href="/themes/default/plugins/select2/select2.min.css")
  style.
    #slides li {
      padding-bottom: 10px;
      border-bottom: 1px solid #ccc;
      list-style-type: none;
      margin-top: 10px;
    }
block main
  form#groupForm.form-horizontal(method="post",action="/shop/product/option/save")
    input(type='hidden', name='_csrf', value=_csrf)
    if !option.isNew
      input#id(type='hidden', name='id', value="#{option._id}")

    .panel(style="position:relative;")
      .panel-heading
        h3.panel-title
          span.text-info #{option.name} #{option.isNew ? '添加选项' : '编辑选项'}
          .panel-tools.pull-right
            a.btn.btn-default.btn-sm(href='/shop/product/option/list')
              i.fa.fa-reply
            a#save.btn.btn-sm.btn-default(title="保存",href="javascript:void(0);")
              i.fa.fa-save
      .panel-body
        .form-group
          label.control-label.col-sm-2.required 名称：
          .col-sm-8
            input#name.form-control.required(type="text",name="name",value="#{option.name}")
        .form-group
          label.control-label.col-sm-2.required 类型：
          .col-sm-8
            select#type.form-control.required(name='type' style="width: 100%;")
              option(value='') -请选择-
              each e,i in types
                if e.code == option.type
                  option(value='#{e.code}' selected) #{e.name}
                else
                  option(value='#{e.code}') #{e.name}

        .form-group
          label.control-label.col-sm-2 排序：
          .col-sm-8
            input#sort.form-control(type="text",name="sort",value="#{option.sort}")
            p.help-block 根据此数字小到大排序

        .form-group
          label.control-label.col-sm-2 描述：
          .col-sm-8
            textarea#description.form-control(name="description" rows='3')
              | #{option.description}

        #option.form-group
            button#winners.btn.btn-sm.pull-right(title='添加项值',type='button')
              i.fa.fa-plus
          #winnersTilte
            #values.box-header.with-border
              .paramsTitle.clearfix
                .col-sm-7
                  label.control-label 名称
                .col-sm-3
                  label.control-label 排序
                .col-sm-2.text-right
                  label.control-label 删除
          #winnersBody.paramsBody.clearfix
            each e,i in values
              .alert
                .col-sm-7
                  input.form-control.names.required(type='text' name='names' placeholder='名称' value='#{e.name}')
                .col-sm-3
                  input.form-control.sort(type='number' name='sorts' value='#{e.sort}')
                .col-sm-2.form-group
                  button.close(data-dismiss='alert' aria-label='Close' type="button")
                    span(aria-hidden='true') &times;


block scripts
  //script(src='/themes/default/plugins/select2/select2.full.js')
  //script(src="//cdn.bootcss.com/bootstrap-filestyle/1.2.1/bootstrap-filestyle.min.js")
  script.
    $(document).ready(function () {
      //initSelect2("#store", "/shop/product/option/getStore");

      //$(".image").filestyle({buttonText: '上传图片'});
      var form = $('#groupForm');
      $("#save").on('click', function () {
        form.submit();
      });
      form.validate({
        rules: {
          name: {
            required: true,
            remote: '/shop/product/option/checkName?oldName=#{option ? option.name : ''}'
          }
        },
        messages: {
          name: {
            remote: '名称已经重复，请修改为其他'
          }
        }
      });
      $("#winners").on('click', function () {
        addWinners();
      });

      $("#type").change(function(e){
        var type = $(this).val();
        if(type == 'Text'){
          hideDiv();
        }else if(type == 'Checkbox' || type == 'Radio' || type == 'Select' ){
          showDiv();
        }
      });

    });

    function addWinners() {
      var html = $("<div class='alert'>" +
        "<div class='col-sm-7'><input class='form-control names required' type='text' name='names' placeholder='名称' value=''/></div>" +
        "<div class='col-sm-3'><input class='form-control sort' type='number' name='sorts' value='0'/></div>" +
        "<div class='col-sm-2 form-group'><button type='button' class='close' data-dismiss='alert' aria-label='Close'>" +
        "<span aria-hidden='true'>&times;</span></button></div></div>");
      $("#winnersBody").append(html)
    }

    function addOption() {
      var html = $("<div class='alert'>" +
        "<div class='col-sm-7'><input class='form-control names required' type='text' name='names' placeholder='名称' value=''/></div>" +
        "<div class='col-sm-3'><input class='form-control sort required' type='number' name='sorts' value='0'/></div>" +
        "<div class='col-sm-2 form-group'><button type='button' class='close' data-dismiss='alert' aria-label='Close'>" +
        "<span aria-hidden='true'>&times;</span></button></div></div>");
      $("#winnersBody").append(html)
    }

    //控制类型为一项时隐藏掉多选操作的div
    function hideDiv(){
      $("#winnersBody").empty();
      $("#option").hide();
      $("#winnersTilte").hide();

    }

    //控制类型为多项时显示多选操作的div
    function showDiv(){
      $("#option").show();
      $("#winnersTilte").show();
      $("#winnersBody").empty();
      addOption();
    }


