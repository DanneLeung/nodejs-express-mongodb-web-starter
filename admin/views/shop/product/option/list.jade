//
   Created by yu869 on 2015/10/26.

extends ../layout
block header
  link( rel="stylesheet" href="//cdn.bootcss.com/datatables/1.10.11/css/dataTables.bootstrap.min.css")

block main
  .panel
    .panel-heading
      h3.panel-title 商品选项列表
      .panel-tools
        a.btn.btn-sm.btn-primary(href="/shop/product/option/add")
          i.fa.fa-plus.fa-fw
          | 添加选项
        a#saveSort.btn.btn-sm.btn-primary(href="javascript:void(0);")
          i.fa.fa-plus.fa-fw
          | 保存排序
    .panel-body
      form#sortForm(method="post",action="/shop/product/option/saveSort")
        input#_csrf(type='hidden', name='_csrf', value=_csrf)

        #tableWrapper(style="display:none")
          table#pageList.table.table-bordered.table-hover.table-striped
            thead
              th 名称
              th 类型
              th 排序
              th 描述
              th.text-center 操作
            tbody


//应用添加的脚本在scripts block中定义
block scripts
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/jquery.dataTables.min.js')
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/dataTables.bootstrap.min.js')
  script.
    $(document).ready(function () {
      var opts = {
        "language": {
          "url": "/themes/default/plugins/datatables/Chinese.json"
        },
        autoWidth: false,
        lengthChange: false,
        searching: false,
        processing: false,
        //scrollX:true,
        stateSave: true,
        serverSide: true,
        deferRender: true
      };

      var table = $('#pageList').DataTable($.extend(opts, {
        order: [[2, 'asc']],
        ajax: {url: '/shop/product/option/datatable'},
        columnDefs: [
          {
            targets: -1, visible: true, sortable: false, className: 'text-center',
            render: function (data, type, row) {
              return "<div class='btn-group'><a class='btn btn-default btn-sm key' title='修改' href='/shop/product/option/edit/"
                      + row._id + "'><i class='fa fa-edit'></i></a>"
                      + "<a class='btn btn-default btn-sm key del' title='删除' href='#'><i class='fa fa-trash-o'></i></a></div>";
            }
          }
        ],
        columns: [
          {data: "name", defaultContent: ''},
          {data: "type", defaultContent: '', render: function (data, type, full, meta) {
            var html = data == 'Checkbox' ? "多选": data == 'Radio' ? "单选":data == 'Select' ? "下拉":data == 'Text' ? "文本":"";
            return html;
          }},
          {
            data: "sort", defaultContent: '', render: function (data, type, full, meta) {
            var html = "<input type='hidden' name='id' value='" + full._id + "'/>" +
                    "<input type='number' name='sort' value='" + data + "'/>"

            return html;
          }
          },
          {data: "description", defaultContent: ''},
          {data: ""}
        ]
      })).on('draw.dt', function () {
        $('#tableWrapper').fadeIn();
      })

      //删除奖品的事件}

      $('#pageList').on('click', 'a.del', function () {
        var id = table.row($(this).parents('tr')).data()._id;
        if (id) {
          bootbox.confirm("确定要删除数据吗?", function (result) {
            if (result) {
              window.location.href = '/shop/product/option/del/' + id;
            }
          });
        }
      });

      $('#saveSort').on('click', function () {
        $("#sortForm").submit();
      });


    });
