//
   Created by yu869 on 2015/11/9.

//
   Created by yu869 on 2015/11/9.
extends layout
block header
  link( rel="stylesheet" href="//cdn.bootcss.com/datatables/1.10.11/css/dataTables.bootstrap.min.css")
  link( rel="stylesheet" href="/themes/default/plugins/select2/select2.min.css")
//应用的page title
block pageTitle
  if viewType == 'add'
    h1 分类新增
      small 添加分类信息
  if viewType == 'edit'
    h1 分类编辑
      small 编辑分类信息
  if viewType == 'view'
    h1 分类查看
      small 查看分类信息
block main
  .panel
    .panel-heading.with-border
      if viewType == 'add'
        h3.panel-title 添加分类信息
      if viewType == 'edit'
        h3.panel-title 编辑分类信息
      if viewType == 'view'
        h3.panel-title 查看分类信息

      .panel-tools
        a.btn.btn-sm.btn-default(href='/shop/product/category/' title='返回')
          i.fa.fa-reply
        button#save.btn.btn-sm.btn-default(title='保存')
          i.fa.fa-save
    .panel-body
      div#categoryEdit.row
        .col-md-12
          form#categoryForm.form-horizontal(name='categoryForm', action='/shop/product/category/save', method='post')
            if viewType == 'edit'
              input#id(type='hidden', name='id', value="#{category == null ? '' : category._id}")

            input#_csrf(type='hidden', name='_csrf', value=_csrf)
            .form-group
              label.control-label.col-sm-2 上级分类:
              .col-sm-9
                select#parentId.form-control(name='parentId')
                  option(value="") --请选择--
                  if categorys
                    each m ,i in categorys
                      if(m.id == category.parentId)
                        option(value="#{m.id}", selected="selected") #{paddingLeft(m.name, ' - ', m.depth - 1)}
                      else
                        option(value="#{m.id}") #{paddingLeft(m.name, ' - ', m.depth - 1)}

            .form-group
              label.control-label.col-sm-2.required 名称:
              .col-sm-9
                input#name.form-control.required(type='text',name='name',placeholder='分类名称', value="#{category == null ? '' : category.name}")
            .form-group
              label.control-label.col-sm-2.required 标识:
              .col-sm-9
                if viewType == 'edit'
                  input#code.form-control.required(type='text',name='code',placeholder='标识',readonly='true' value="#{category == null ? '' : category.code}")
                if viewType == 'add'
                  input#code.form-control.required(type='text',name='code',placeholder='标识', value="#{category == null ? '' : category.code}")
                p.help-block 唯一标识，不可与其它分类重复，不可为空，创建后不可修改
            .form-group
              label.control-label.col-sm-2 排序:
              .col-sm-9
                input#sort.form-control(type='number',name='sort',placeholder='分类排序', value="#{category == null ? '' : category.sort}")
                p.help-block 同级分类中排序序号，越小排序越靠前

            .form-group
              label.control-label.col-sm-2 顶置分类:
              .col-sm-9
                .checkbox.icheck
                  label
                    if(category.topNav)
                      input(type='checkbox',name="topNav", checked="checked")
                    else
                      input(type='checkbox',name="topNav")
            .form-group
              label.control-label.col-sm-2 激活:
              .col-sm-9
                .checkbox.icheck
                  label
                    if(category.enabled)
                      input(type='checkbox',name="enabled", checked="checked")
                    else
                      input(type='checkbox',name="enabled")
            .form-group
              label.control-label.col-sm-2 描述:
              .col-sm-9
                textarea#description.form-control(name='description',placeholder='描述')
                  | #{category == null ? '' : category.description}

//应用添加的脚本在scripts block中定义
block scripts
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/jquery.dataTables.min.js')
  script(src='//cdn.bootcss.com/datatables/1.10.11/js/dataTables.bootstrap.min.js')
  script.
    $(document).ready(function () {
      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue',
        increaseArea: '20%' // optional
      });

      var form = $('#categoryForm');
      $("#save").on('click', function () {
        form.submit();
      });
      form.validate({
        rules: {
          code: {
            required: true,
            remote: '/shop/product/category/checkCode?oldCode=#{category ? category.code : ''}'
          },
          name: {
            required: true,
            remote: '/shop/product/category/checkName?oldName=#{category ? category.name : ''}'
          }
        },
        messages: {
          code: {required:"标识为必填项！",remote:"标识必须唯一"},
          name: {required:"名称为必填项！",remote:"名称必须唯一"}
        }
      });
    });

