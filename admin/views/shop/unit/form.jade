//
   Created by yu869 on 2016/3/31.

extends ../layout
block header
//应用的page title
block pageTitle
  if unit.isNew
    h1 单位新增
      small 添加单位信息
  if !unit.isNew
    h1 单位编辑
      small 编辑单位信息
block main
  .panel
    .panel-heading.with-border
      if unit.isNew
        h3.panel-title 添加单位信息
      if !unit.isNew
        h3.panel-title 编辑单位信息
      .panel-tools
        a.btn.btn-box-tool.btn-default(href='/shop/unit/list')
          i.fa.fa-reply
          span  返回
        | &nbsp;
        button#save.btn.btn-box-tool.btn-default
          i.fa.fa-save
          span  保存
        | &nbsp;
      //button.btn.btn-box-tool(data-widget="collapse")
      //  i.fa.fa-caret-left
    .panel-body
      div#userEdit.row
        .col-md-12
          form#unitForm.form-horizontal(name='unitForm', action='/shop/unit/save', method='post')
            input#id(type='hidden', name='id', value="#{unit._id}")
            input#_csrf(type='hidden', name='_csrf', value=_csrf)

            .form-group
              label.control-label.col-md-3.required 类型：
              .controls.col-md-8
                select#type.form-control.required(name='type')
            .form-group
              label.control-label.col-md-3.required 标题：
              .controls.col-md-8
                input#title.form-control.required(name='title',placeholder='单位标题', value="#{unit ? unit.title : ''}")
            .form-group
              label.control-label.col-md-3 单位：
              .controls.col-md-8
                input#unit.form-control(name='unit',placeholder='单位缩写', value="#{unit ? unit.unit : ''}")

            .form-group
              label.control-label.col-md-3 单位值：
              .controls.col-md-8
                input#value.form-control(name='value',placeholder='单位显示名称', value="#{unit ? unit.value : ''}")

//应用添加的脚本在scripts block中定义
block scripts
  //script(src='/themes/default/plugins/datepicker/bootstrap-datepicker.js')
  script(src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/locale/zh-cn.js')
  script(src="//cdn.bootcss.com/bootstrap-filestyle/1.2.1/bootstrap-filestyle.min.js")
  script.
    $(document).ready(function () {
      $('input').iCheck({
        checkboxClass: 'icheckbox_square-blue',
        radioClass: 'iradio_square-blue',
        increaseArea: '20%' // optional
      });
      select('#{unit ? unit.type : "" }');

      $(".form-group").find(':file').filestyle({buttonText: '上传图片'});

      var form = $('#unitForm');
      $("#save").on('click', function () {
        form.submit();
      });
      //validator
      form.validate({
        rules: {
          title: {
            required: true,
            remote: '/shop/unit/checkTitle?oldTitle=#{unit ? unit.title : ''}'
          }, type: {
            required: true
          }
        },
        messages: {
          title: {
            remote: '单位标题已存在'
          }, type: {
            required: '请选择类型'
          }
        }
      });

    });
    function select(type){
      var types = [{code:'',name:'-请选择-'},{code:'length',name:'长度单位'},{code:'weight',name:'重量单位'}];
      $.each(types,function(i,e){
        if(e.code == type){
          $("#type").append("<option value='" + e.code + "' selected>" + e.name + "</option>");
        }else{
          $("#type").append("<option value='" + e.code + "'>" + e.name + "</option>");
        }
      });

    }
