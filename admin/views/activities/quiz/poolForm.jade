//
   Created by pc on 2015/10/27.

extends ../layout

block main
  .panel
    .panel-heading
      h3.panel-title
        | #{quiz.isNew ? '添加题库' : '修改题库'}
        span.text-info #{quiz.name}
        .panel-tools.pull-right
          a.btn.btn-default.btn-sm(href='/activities/quiz/pool')
            i.fa.fa-reply
          a.btn.btn-default.btn-sm(href='/file/template/topicTemplate.xlsx' title='下载题目模板')
            i.fa.fa-cloud-download
          a#save.btn.btn-default.btn-sm(title='保存')
            i.fa.fa-save
    .panel-body
      if !quiz.isNew
        form#userDelForm(method='post', style='display:none', action='/activities/quiz/pool/del')
          input#ids(type='hidden',name='ids',value="#{quiz._id}")
          input#_csrf(type='hidden', name='_csrf', value=_csrf)

      form#quizForm.form-horizontal(method="post",action="/activities/quiz/pool/save",enctype="multipart/form-data")
        if(!quiz.isNew)
          input#id(type='hidden', name='id', value="#{quiz._id}")
        input#_csrf(type='hidden', name='_csrf', value=_csrf)
        .form-group
          label.control-label.col-sm-3.required 名称
          .col-sm-8
            input#name.form-control(type="text",name="name",value="#{quiz.name}")
        .form-group
          label.control-label.col-sm-3 题目导入
          .col-sm-8
            input#quiz.form-control(type="file",name="quiz")
            p.help-block 选择题目的文件（格式为：xlsx、xls）
        .form-group
          label.control-label.col-sm-3 问题数
          .col-sm-8
            input#count.form-control(type="text",name="count",value="#{quiz.count}")
            p.help-block 当使用该题库时提供多少道题，不填写默认 10 道题
        .form-group
          label.control-label.col-sm-3 说明
          .col-sm-8
            textarea#description.form-control(name="description", rows="5")
              | #{quiz.description}

block scripts
  script(src="//cdn.bootcss.com/bootstrap-filestyle/1.2.1/bootstrap-filestyle.min.js")
  script.
    $(document).ready(function () {

      $(".form-group").find(':file').filestyle({buttonText: '上传文件'});

      var form = $('#quizForm');
      $("#save").on('click', function () {
        form.submit();
      });
      form.validate({
        rules: {
          name: {
            required: true,
            remote: '/activities/quiz/pool/checkName?oldName=#{quiz ? quiz.name : ''}'
          },count: {
            digits: true
          }
        },
        messages: {
          name: {
            remote: '名称保持唯一'
          }
        }
      });

    });
