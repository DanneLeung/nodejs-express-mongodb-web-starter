<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta charset="utf-8"/><meta name="keywords" content="尊行贵宾服务厅"/><meta name="description" content="尊行贵宾服务厅"/><meta name="format-detection" content="telephone=no,email=no"/><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1.0, user-scalable=no, minimal-ui"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="grey"/><meta name="screen-orientation" content="portrait"/><meta name="x5-orientation" content="portrait"/><meta http-equiv="pragma" content="no-cache"/><meta http-equiv="Cache-Control" content="no-cache, must-revalidate"/><link href="#{themeRoot|/images/icon.png" rel="apple-touch-icon-precomposed"/><link href="#{themeRoot|/images/icon.png" rel="Shortcut Icon" type="image/x-icon"/><!--link(rel='stylesheet', href='css/reset-dd4d28d405.min.css')--><!--link(rel='stylesheet', href='css/ratchet-a616f7322e.min.css')--><!--link(rel='stylesheet', href='css/theme-ios.min.c  ss')--><!--link(rel='stylesheet', href='css/weui-231163a470.min.css')--><link rel="stylesheet" href="css/swiper-cbdb375954.min.css"/><!--link(rel='stylesheet', href='css/loaders.min.cs s')--><link rel="stylesheet" href="css/app-a75aa265b0.min.css"/><link rel="stylesheet" href="css/layout-25c27c10d6.min.css"/><!-- 自动字体大小适配--><!--script.(function (doc, win) {
  var docEl = doc.documentElement,
          resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
          recalc = function () {
            var clientWidth = docEl.clientWidth;
            if (!clientWidth) return;
            docEl.style.fontSize = (24 * clientWidth / 627) + 'px';
          };
  if (!doc.addEventListener) return;
  win.addEventListener(resizeEvt, recalc, false);
  //doc.addEventListener('DOMContentLoaded', recalc, false);
  recalc();
})(document, window);--><title>鸣泰移动商城</title><style type="text/css">.qrCode {
  text-align: center;
  padding: 50px;
  margin: 0 auto;
}

.card {
  padding: 10px;
}
</style></head><body class="mhome hide-landing"><header id="topheader" style="display:none;" class="topheader"></header><div id="scwrapper" class="scroll-wrapper"><div id="newviewport" class="viewport-new"><div class="block-white"><div><div id="order"></div></div></div><div id="useModal" class="modal"><header class="bar bar-nav"><a href="#useModal" class="icon icon-close pull-right"></a><h1 class="title">扫码进入</h1></header><div class="content"><div id="qrCode" class="qrCode"></div></div></div></div><footer class="jd-footer"><div class="jd-1px-line-up"></div><ul class="jd-footer-links"><li><a href="home.html">danneleung</a></li><li><a href="">反馈</a></li><li><a href="logout.html">退出</a></li><li><a href="javascript:void(0)" onclick="window.scrollTo(0,0);">回到顶部</a></li></ul><div class="jd-1px-line-up"></div><div class="jd-footer-copyright">Copyright &copy; 2013-2016 上海鸣泰信息科技股份有限公司，版权所有.</div></footer></div><script type="text/javascript" src="js/all-f3dd6145ab.min.js"></script><!-- 百度统计代码--><!--script.var _hmt = _hmt || [];
(function () {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?278190ab2a22211d9b8e0dffbdd1b5f1";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();--><script type="text/javascript" src="js/jquery.qrcode.js"></script><script id="orderDetail" type="text/html" charset="utf-8"><div class="card">
  <h4><small>订单号:  </small><%=$data.no%></h4>
  <h4>手机: <%=$data.phone%></h4>
  <h4>使用者: <%=$data.useName%></h4>
  <h4>卡号: <%=$data.memberCardNo%></h4>
  <h4>金额: ￥<%=$data.amount%></h4>
  <h4>时间: <%=$data.createdAt%></h4>
  <%if($data.status == '01') {%>
    <a class="btn btn-block" href="paySelect.html?orderId=<%=$data._id%>">支付</a>
    <button class="btn btn-negative btn-block" onclick="cancelOrder('<%=$data._id%>')">取消订单</button>
  <%} else if($data.status == '02') {%>
    <%if($data.orderType == '02') {%>
    <a class="btn btn-positive btn-block" href="#useModal">使用</a>
    <%}%>
  <button class="btn btn-negative btn-block" onclick="cancelOrder('<%=$data._id%>')">取消订单</button>
  <%} else if($data.status == '03') {%>
  <%} else if($data.status == '04') {%>
  <%} else if($data.status == '05') {%>
  <%} else if($data.status == '06') {%>
<%}%>
</div>
</script><script type="text/javascript">/**
 * 加载订单
 */
function loadOrderDetail(cb) {
  var orderId = getQueryString('orderId');
  $.getJSON(baseUrl + '/api/v1/order/find/orderId', {'orderId': orderId}, function (data) {
    var html = template('orderDetail', data);
    $('#order').append(html);
    if ($.isFunction(cb)) {
      cb();
    }
  })
}

/**
 * 取消订单
 */
function cancelOrder(orderId) {
  $.getJSON(baseUrl + '/api/v1/order/find/cancelOrder', {'orderId': orderId}, function (data) {
    if (data == "success") {
      window.location = "order.html"
    }
  })
}

var url = baseUrl + "/api/v1/once/order/use?openid=" + localStorage["user.openid"] + "&memberCardId=" + getQueryString('memberCardId');
//长连接转短连接
W.getShortUrl(url, function (shortUrl) {
  $("#qrCode").qrcode({
    width: 300,
    height: 300,
    text: shortUrl
  });
});

Zepto(function ($) {
  loadOrderDetail();
});</script></body></html>